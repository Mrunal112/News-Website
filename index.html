<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stark News</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/b8bed4b29e.js" crossorigin="anonymous"></script>
</head>

<body>
    <nav>
        <div class="main-nav container flex">
            <a class="company-logo" href="#" onclick='reload()'>
                <img src="assets/Logo.png" alt="Company Logo">
            </a>
            <div class="nav-links">
                <ul class="flex">
                    <li class="hover-links nav-item" id="technology" onclick="onNavItemClick('technology')">Technology</li>
                    <li class="hover-links nav-item" id="finance" onclick="onNavItemClick('finance')">Finance</li>
                    <li class="hover-links nav-item" id="politics" onclick="onNavItemClick('politics')">Politics</li>
                </ul>
            </div>
            <div class="search-bar flex">
                <input id="search-text" type="text" class="news-input" placeholder="e.g. Science">
                <button class="search-button" id="search-button" onclick='search()'>Search</button>
            </div>
        </div>
    </nav>

    <main>
        <div class="cards-container container flex" id="cards-container">
    </main>

    <div class="container">
        <footer class="">
            <hr class="line">
            <span>&copy; 2023, <a href="#" onclick='reload()'>Stark News</a>, All Rights Reserved</span>
            <a href="https://twitter.com/MrunalMunjamka1" class="twitter" target="_blank"><i class="fa-brands fa-twitter  fa-xl" style="color: #000000;"></i></a>
            <a href="https://www.instagram.com/__mrunal___/" class="instagram" target="_blank"><i class="fa-brands fa-instagram fa-xl" style="color: #000000;"></i></a>
        </footer>
    </div>

    <template id="template-news-card">
        <div class="card">
            <div class="card-header">
                <img src="http://via.placeholder.com/400x200" alt="news-img" id="news-img">
            </div>
            <div class="card-content">
                <h3 id="news-title">This is the Title</h3>
                <h6 class="news-source" id="news-source">End Gadget 26/08/2023</h6>
                <p class="news-desc" id="news-desc">Lorem ipsum dolor sit amet consectetur adipisicing elit. Amet est
                    magnam molestiae velit ipsum temporibus magni rem alias, dicta repellat.</p>
            </div>
        </div>
        </div>
    </template>

<!--     <script src="script.js"></script> -->
    <script> const API_KEY = "9e68f01097c54fada3dd2884f2c3205f";
const url = "https://newsapi.org/v2/everything?q=";

window.addEventListener('load', () => fetchNews("AI"));

function reload() {
    window.location.reload();
}

async function fetchNews(query) {
    const res = await fetch(`${url}${query}&apiKey=${API_KEY}`);
    // Fetching the information from the server.

    const data = await res.json();
    console.log(data);
    bindData(data.articles);
}

function bindData(articles) {
    const cardsContainer = document.getElementById('cards-container');
    const newsCardTemplate = document.getElementById('template-news-card');

    cardsContainer.innerHTML = "";

    articles.forEach(article => {
        if (!article.urlToImage) return;
        const cardClone = newsCardTemplate.content.cloneNode(true);
        fillDataInCard(cardClone, article);
        cardsContainer.appendChild(cardClone);
    });
}

function fillDataInCard(cardClone, article) {
    const newsImg = cardClone.querySelector("#news-img");
    const newsTitle = cardClone.querySelector("#news-title");
    const newsSource = cardClone.querySelector("#news-source");
    const newsDesc = cardClone.querySelector("#news-desc");

    newsImg.src = article.urlToImage;
    newsTitle.innerHTML = article.title;
    newsDesc.innerHTML = article.description;

    const date = new Date(article.publishedAt).toLocaleString("en-US", {
        timeZone: "Asia/Jakarta"
    });

    newsSource.innerHTML = `${article.source.name}Â· ${date}`;

    cardClone.firstElementChild.addEventListener("click", () => {
        window.open(article.url, "_blank");
    });
}

let curSelectedNav = null;
function onNavItemClick(id) {
    fetchNews(id);
    const navItem = document.getElementById(id);
    curSelectedNav?.classList.remove('active');
    curSelectedNav = navItem;
    curSelectedNav.classList.add('active');
}

function search() {
    const searchButton = document.getElementById("search-button");
    const searchText = document.getElementById("search-text");
    console.log(searchText);

    searchButton.addEventListener('click', () => {
        const query = searchText.value;
        if (!query) return;
        fetchNews(query);
        curSelectedNav?.classList.remove('active');
        curSelectedNav = null;
    });

}

 </script>
</body>

</html>
